function OnLoadSite(){postFileFromServer("EOM.json","",SiteDataCallback);var a="";a+="<div class='HeaderBar'><div class='HeaderBarContainer'><div id='LHeader' class='HeaderBarLeft'> </div> <div id='HeaderBarAppName' class='HeaderBarAppName'>EOM</div> <div id='RHeader' class='HeaderBarAppNamePlus'> </div><div id='NavBar' class='HeaderBarRightNav'> </div></div></div>",a+="<div id='LowerFrame' class='LowerFrame'><div id='LFInt' class='RoundedBox'></div></div>",document.getElementById("Main").innerHTML=a,CheckLogInState(),LoadSettings()}function SiteDataCallback(a){a&&(g_objSite=JSON.parse(a),document.getElementById("HeaderBarAppName")&&(document.getElementById("HeaderBarAppName").innerHTML="<a href='javascript:ShowMenuOfApps()'><span class='BiggerScreens'>"+g_objSite.Language[0].AppName+"</span><span class='SmallerScreens'>"+g_objSite.Language[0].AppNameShort+"</span></a>"),document.getElementById("LFInt")&&ShowAbout(!1))}function CheckLogInState(){var a=getCookie("Credentials");if(!a)return!1;var b="";b+="<div class='RoundedBox'>",b+="Authenticating...",b+="</div>",document.getElementById("LowerFrame").innerHTML=b;var c=JSON.parse(a),d={};d.hUN=sha3_512(c.UN),d.hPP=sha3_512(c.PP),d.Class=0;var e=JSON.stringify(d);g_objUser.UN=c.UN,g_objUser.PP=c.PP,postFileFromServer("EOM.php","LogIn="+encodeURIComponent(e),LogInCallback)}function ShowLogInScreen(){document.getElementById("NavBar").innerHTML="<a href='javascript:ShowAbout(false)' title='About Eyes Only Mail'>&#9863;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowCreateAccountForm()'>New User</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - Sign In";var a="";a+="<div id='LFInt' class='RoundedBox'>",a+="<div class='Controls' style='text-align: center;'>",a+="<form action='javascript:LogIn()'>",a+="<input type='text' id='UN' placeholder='User Name' class='Controls' style='width: 96%;' value='' OnInput='OnChangeCredentials()' OnKeyUp='OnChangeCredentials()' OnChange='OnChangeCredentials()' OnPaste='OnChangeCredentials()'><br><br>",a+="<input type='password' id='PW' placeholder='Passphrase' class='Controls' style='width: 96%;' value='' OnInput='OnChangeCredentials()' OnKeyUp='OnChangeCredentials()' OnChange='OnChangeCredentials()' OnPaste='OnChangeCredentials()'><br><br>",a+="<input type='checkbox' id='StayLoggedIn' class='Controls' checked='yes'> Stay logged in on this device<br><br>",a+="<input type='submit' id='LogInBtn' disabled='true' value='Sign In' class='Controls' OnClick='LogIn()'>",a+="</form>",a+="</div>",a+="</div>",document.getElementById("LowerFrame").innerHTML=a}function OnChangeCredentials(){document.getElementById("UN").value.trim().length>7&&document.getElementById("PW").value.trim().length>7?document.getElementById("LogInBtn").disabled=!1:document.getElementById("LogInBtn").disabled=!0}function LogIn(){document.getElementById("LogInBtn").disabled=!0;var a={};a.UN=sha3_256(document.getElementById("UN").value.trim().toLowerCase()),a.PP=sha3_256(document.getElementById("PW").value.trim());var b=JSON.stringify(a),c={};c.hUN=encodeURIComponent(sha3_512(a.UN)),c.hPP=encodeURIComponent(sha3_512(a.PP));var d=JSON.stringify(c);document.getElementById("StayLoggedIn").checked&&setCookie("Credentials",b,999),g_objUser.UN=a.UN,g_objUser.PP=a.PP,postFileFromServer("EOM.php","LogIn="+encodeURIComponent(d),LogInCallback)}function LogInCallback(a){if(a){var b=g_objUser.UN,c=g_objUser.PP;g_objUser=JSON.parse(a),g_objUser.UN=b,g_objUser.PP=c,GetContacts(g_objUser.ID),ShowInbox()}else ShowLogInScreen()}function ShowCreateAccountForm(){postFileFromServer("EOM.php","GetUsers=GetUsers",UsersListCallback),document.getElementById("NavBar").innerHTML="<a href='javascript:ShowAbout(false)' title='About Eyes Only Mail'>&#9863;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowLogInScreen()'>Sign In</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - New User";var a="";a+="<div id='LFInt' class='RoundedBox'>",a+="<div class='Controls' style='text-align: center;'>",a+="<input type='text' id='UN' placeholder='User Name' class='Controls' style='width: 96%;' value='' OnInput='OnChangeNewCredentials()' OnKeyUp='OnChangeNewCredentials()' OnChange='OnChangeNewCredentials()' OnPaste='OnChangeNewCredentials()' OnBlur='OnBlurUN()' OnFocus='OnFocusUN()'><br><br>",a+="<input type='password' id='NewPW' placeholder='Passphrase' class='Controls' style='width: 96%;' value='' OnInput='OnChangeNewCredentials()' OnKeyUp='OnChangeNewCredentials()' OnChange='OnChangeNewCredentials()' OnPaste='OnChangeNewCredentials()'><br><br>",a+="<input type='password' id='ConfirmPW' placeholder='Confirm Passphrase' class='Controls' style='width: 96%;' value='' OnInput='OnChangeNewCredentials()' OnKeyUp='OnChangeNewCredentials()' OnChange='OnChangeNewCredentials()' OnPaste='OnChangeNewCredentials()'><br><br>",a+="<input type='text' id='Name' placeholder='First and last name' class='Controls' style='width: 96%;' value='' OnInput='OnChangeNewCredentials()' OnKeyUp='OnChangeNewCredentials()' OnChange='OnChangeNewCredentials()' OnPaste='OnChangeNewCredentials()'><br><br>",a+="<input type='checkbox' id='StayLoggedIn' class='Controls' checked='yes'> Stay logged in on this device<br>",a+="<p id='Feedback' class='CopyCentered' style='font-size: 75%;'>User names must be at least eight characters</p>",a+="<input type='button' id='CreateAccntBtn' disabled='true' value='Create Account' class='Controls' OnClick='CreateNewAccountBtn()'>",a+="</div>",a+="</div>",document.getElementById("LowerFrame").innerHTML=a}function UsersListCallback(a){a&&(g_objUsers=JSON.parse(a))}function OnChangeNewCredentials(){document.getElementById("CreateAccntBtn").disabled=!0;var a=document.getElementById("UN").value.trim(),b=document.getElementById("NewPW").value.trim(),c=document.getElementById("ConfirmPW").value.trim(),d=document.getElementById("Name").value,e="";a.length<8?e="User names must be at least eight characters":OnFocusUN.bValidUN?b.length<8?e="Passphrases must be at least eight characters":c!==b?e="Passphrases do not match":d.length<4?e="Your name must be at least four characters":(document.getElementById("CreateAccntBtn").disabled=!1,e=""):e="<span style='color: red;'>Sorry, that user name is already taken.  Try another?</span>",document.getElementById("Feedback").innerHTML=e}function OnFocusUN(){document.getElementById("UN").style.backgroundColor="white",OnFocusUN.bValidUN=!0}function OnBlurUN(){OnFocusUN.bValidUN=!0;var a=document.getElementById("UN").value.trim().toLowerCase();a=sha3_512(a);for(var b=0;b<g_objUsers.Users.length;b++)if(a===g_objUsers.Users[b].hUN)return document.getElementById("UN").style.backgroundColor="pink",document.getElementById("Feedback").innerHTML="<span style='color: red;'>Sorry, that user name is already taken.  Try another?</span>",OnFocusUN.bValidUN=!1,document.getElementById("CreateAccntBtn").disabled=!0,!1;return OnFocusUN.bValidUN}function CreateNewAccountBtn(){function j(d){if(d){document.getElementById("RHeader").innerHTML=" - Working..";var f="";f+="<div id='LFInt' class='RoundedBox'>",f+="Account created successfully for "+e+".<br><br>",f+="</div>",document.getElementById("LowerFrame").innerHTML=f,g_objUser.UN=b,g_objUser.PP=c;var g={};g.UN=b,g.PP=c;var i=JSON.stringify(g);a&&setCookie("Credentials",i,999),InitializeContactsFile(d,e,c,h)}}document.getElementById("CreateAccntBtn").disabled=!0;var a=document.getElementById("StayLoggedIn").checked,b=sha3_256(document.getElementById("UN").value.trim().toLowerCase()),c=sha3_256(document.getElementById("NewPW").value.trim()),e=(document.getElementById("ConfirmPW").value.trim(),document.getElementById("Name").value.trim());if(!OnBlurUN())return!1;var f={};f.hUN=encodeURIComponent(sha3_512(b)),f.hPP=encodeURIComponent(sha3_512(c)),f.hWords="",f.pWords="";new Date;f.wWordsExpiration="",f.wName="",f.pName=encodeURIComponent(CryptoJS.AES.encrypt(e,c)),f.ID="";var h=g_objSite.Colors[getRandomInt(0,g_objSite.Colors.length-1)];f.pColor=encodeURIComponent(CryptoJS.AES.encrypt(h,c)),f.wColor="";var i=JSON.stringify(f);postFileFromServer("EOM.php","NewAccount="+i,j),document.getElementById("RHeader").innerHTML=" - Working."}function InitializeContactsFile(a,b,c,d){function k(a){if(a){document.getElementById("RHeader").innerHTML=" - Working...";var b={};b.hUN=sha3_512(g_objUser.UN),b.hPP=sha3_512(g_objUser.PP);var c=JSON.stringify(b);postFileFromServer("EOM.php","LogIn="+encodeURIComponent(c),LogInCallback)}}var e=[],f={};f.ID=a,f.Name=b,f.PP=sha3_512(MakeRandomCode(40)+" "+MakeRandomCode(40)+" "+MakeRandomCode(40)),f.PP=f.PP.trim(),f.Color=d,f.bActive=!0,e[0]=f;var g=JSON.stringify(e),h=encodeURIComponent(CryptoJS.AES.encrypt(g,c)),i={};i.ID=a,i.eMe=h;var j=JSON.stringify(i);postFileFromServer("EOM.php","InitializeContactsFile="+j,k)}function ShowAbout(a){a?(InboxRefreshTimer(!1),document.getElementById("NavBar").innerHTML="<a href='javascript:ShowSettings()' title='Settings'>&#9881;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowContacts()' title='Contacts'>&#9783;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;"):document.getElementById("NavBar").innerHTML="<a href='javascript:ShowLogInScreen()'>Sign In</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowCreateAccountForm()'>New User</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - About";var b="";b+="<div id='LFInt' class='RoundedBox'>";for(var c=0;c<g_objSite.Language[0].IntroCopy.length;c++)b+="<div class='Para' style='-webkit-animation: OpenBox 1.4s ease-in-out "+1*c+"s backwards; -moz-animation: OpenBox 1.4s ease-in-out "+1*c+"s backwards; animation: OpenBox 1.4s ease-in-out "+1*c+"s backwards;'>",b+=g_objSite.Language[0].IntroCopy[c],b+="</div>";g_objUsers&&(b+="<p style='text-align: center;'>Version: "+g_objSite.Version+" "+g_objUsers.Users.length+"</p>"),b+="</div>",document.getElementById("LowerFrame").innerHTML=b}function ShowInbox(){g_objContacts||setTimeout(RefreshMessageList,100),InboxRefreshTimer(!0),DestroyEditor(),document.getElementById("NavBar").innerHTML="<a href='javascript:ShowComposeEMail(-1)' title='Compose Mail'>&#9998;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowSettings()' title='Settings'>&#9881;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:RefreshMessageList()' title='Refresh'>&#8635;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowContacts()' title='Contacts'>&#9783;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - Inbox";var a="";a+="<div id='Inbox'>",g_objSite&&(a+="<div class='RoundedBox'><span style='color: gray;'><a href='javascript:RefreshMessageList()' title='Show messages'>"+g_objSite.Language[0].Loading+"</a></span></div>"),a+="</div>",document.getElementById("LowerFrame").innerHTML=a,g_sMessageList&&(document.getElementById("Inbox").innerHTML=g_sMessageList);var b={};b.ID=g_objUser.ID,b.First=0,b.Last=20,b.Location="Inbox";var c=JSON.stringify(b);postFileFromServer("EOM.php","GetSMList="+c,GetMessagesCallback)}function RefreshMessageList(){document.getElementById("RHeader").innerHTML=" - Refreshing...";var a={};a.ID=g_objUser.ID,a.First=0,a.Last=20,a.Location="Inbox";var b=JSON.stringify(a);postFileFromServer("EOM.php","GetSMList="+b,GetMessagesCallback)}function GetMessagesCallback(a){if(document.getElementById("RHeader").innerHTML=" - Refreshing...",a){var b=0,c="";clearCurrentAddressingArrays(),g_aMessages=[];for(var d=JSON.parse(a),e=0;e<d.Msgs.length;e++){var f=JSON.parse(d.Msgs[e].Data);f.Date=d.Msgs[e].Date;for(var g="",h="",i=!1,j=0;j<g_objContacts.length;j++)if(f.From==g_objContacts[j].ID){g=g_objContacts[j].PP,h=g_objContacts[j].Name,i=!0;break}if(i){var k=decodeAES(f.Msg,g);g_aMessages[e]=JSON.parse(k);var l=new Date,m=g_aMessages[e].KillDate+g_aMessages[e].Date;if(g_aMessages[e].KillDate&&m<l.valueOf()){var n={};n.UserID=g_objUser.ID,n.MsgToDelete=g_aMessages[e].Date;var o=JSON.stringify(n);postFileFromServer("EOM.php","DelSM="+o,DelMessageSilentCallback)}else if(g_aMessages[e].Subj){var p=MakeMsgSummaryBox(e,j);c+=p.sItem,p.bUnread&&b++}}else RefreshContacts(!0),setTimeout(function(){GetContacts(g_objUser.ID)},3e3)}c||(c="<div class='RoundedBox' style='color: blue;'>You have no messages at this time.<br><br><a href='javascript:AddAContact()'>Add a contact?</a></div>",g_sMessageList=c,document.getElementById("Inbox").innerHTML=c),g_sMessageList!=c&&(document.getElementById("Inbox").innerHTML=c,g_sMessageList=c),document.getElementById("RHeader").innerHTML=b?" - Inbox ("+b+")":" - Inbox",document.title=b?"EOM ("+b+")":"Eyes Only Mail"}else document.getElementById("Inbox").innerHTML="<div class='RoundedBox' style='color: blue;'>You have no messages at this time.<br><br><a href='javascript:AddAContact()'>Add a contact?</a></div>"}function InboxRefreshTimer(a){a?InboxRefreshTimer.InboxTimer=setInterval(RefreshMessageList,6e5):InboxRefreshTimer.InboxTimer&&(clearInterval(InboxRefreshTimer.InboxTimer),InboxRefreshTimer.InboxTimer=null)}function MakeMsgSummaryBox(a,b){var c={};c.bUnread=!1,c.sItem="";var d=new Date(Number(g_aMessages[a].Date));if(g_objContacts[b].Color||(g_objContacts[b].Color="#ffba00"),c.sItem+="<div class='RoundedBox' onclick='ViewMessage("+a+")'> ",c.sItem+="<div style='display: inline-block; width: 10%; float: left;'><div class='ContactIcon' style='background-color: "+g_objContacts[b].Color+";'>"+g_objContacts[b].Name[0]+"</div></div>",c.sItem+="<div style='display: inline-block; width: 90%; line-height: 125%;'>",c.sItem+=g_aMessages[a].DateRead?g_objContacts[b].Name+" - ":"<b>"+g_objContacts[b].Name+"</b> - ",c.sItem+="<div style='display: inline-block;'>"+d.toLocaleString(),g_aMessages[a].KillDate){var e=new Date(d.valueOf()+g_aMessages[a].KillDate);c.sItem+=" <span title='Auto delete after "+e.toLocaleString()+"'>&#9719;</span></div><br>"}else c.sItem+="</div><br>";return g_aMessages[a].DateRead?c.sItem+=g_aMessages[a].Subj+"</div>":(c.sItem+="<b>"+g_aMessages[a].Subj+"</b></div>",c.bUnread=!0),c.sItem+="</div>",c}function ViewMessage(a){InboxRefreshTimer(!1),clearCurrentAddressingArrays(),DestroyEditor(),g_aMessages[a].DateRead||MarkMessageRead(a,!0),document.getElementById("RHeader").innerHTML=" - Message";var b="";b+="<a href='javascript:Reply("+a+", false)' title='Reply'>&#8629;</a>&nbsp;&nbsp;&nbsp;";var c=g_aMessages[a].aTo.concat(g_aMessages[a].aCc);c.length>1&&(b+="<a href='javascript:Reply("+a+", true)' title='Reply All'>&#8647;</a>&nbsp;&nbsp;&nbsp"),b+="<a href='javascript:DeleteMessage("+a+")' title='Delete'>&#9760;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("NavBar").innerHTML=b;var d="";d+="<div id='Inbox' class='RoundedBox'>";var e=getName(g_aMessages[a].From),f=new Date(g_aMessages[a].Date);if(d+="<div style='font-size: "+g_objSettings.ptFontSize+"pt; line-height: 140%;'>",d+="<div style='width: 100%; min-height: 10px;'>",d+="<div style='width: 85%; display: inline-block;'>",d+="Date: "+f.toLocaleString(),g_aMessages[a].KillDate){var g=new Date(f.valueOf()+g_aMessages[a].KillDate);d+=" <span title='Auto delete after "+g.toLocaleString()+"'>&#9719;</span><br>"}else d+="<br>";d+="From: <span id='From'>"+e+"</span><br>",d+="Subject: <span id='Subj'>"+g_aMessages[a].Subj+"</span><br>";for(var h=0,i=[],j="",k=0;k<g_objContacts.length;k++)g_objContacts[k].ID==g_aMessages[a].aTo[h]&&(i[h++]=g_objContacts[k].Name);j=i.length==g_aMessages[a].aTo.length?i.join(", "):i.join(", ")+" <span title='Name(s) not in your contact list'>+</span>",d+="To: <span id='To'>"+j+"</span><br>";for(var l=0,m=[],n="",o=0;o<g_objContacts.length;o++)g_objContacts[o].ID==g_aMessages[a].aCc[l]&&(m[l++]=g_objContacts[o].Name);n=m.length==g_aMessages[a].aCc.length?m.join(", "):m.join(", ")+" <span title='Name(s) not in your contact list'>+</span>",g_aMessages[a].aCc.length&&(d+="Cc: <span id='Cc'>"+n+"</span><br>");for(var p=0,q="",r=0;r<g_aMessages[a].aBcc.length;r++)if(g_objUser.ID==g_aMessages[a].aBcc[p])for(var s=0;s<g_objContacts.length;s++)if(g_objUser.ID==g_objContacts[s].ID){q=g_objContacts[s].Name;break}q&&(d+="Bcc: <span id='Bcc'>"+q+"</span><br>"),d+="</div>",d+="<div class='MessageToolbar' style=''>",d+="<span style='font-size: 65%;'><a href='javascript:ShowInbox()' title='Close'>&#9949;</a></span><br>",d+="<span id='MarkedRead'><a href='javascript:MarkMessageRead("+a+", false)' title='Mark unread'>&#9788;</a></span><br>",d+="</div>",d+="</div>",d+="<br>",d+=g_aMessages[a].Body,d+="</div>",d+="</div>",document.getElementById("LowerFrame").innerHTML=d,setTimeout(function(){window.scrollTo(0,0)},700)}function clearCurrentAddressingArrays(){g_objCurrentMessage.aToIDs=[],g_objCurrentMessage.aToNames=[],g_objCurrentMessage.aCCIDs=[],g_objCurrentMessage.aCCNames=[],g_objCurrentMessage.aBCCIDs=[],g_objCurrentMessage.aBCCNames=[],g_objCurrentMessage.AutoDelete=Number(g_objSettings.nAutoDeleteDefault),g_objCurrentMessage.sBody=""}function ShowSettings(){InboxRefreshTimer(!1),g_objSettings.ptFontSize||(g_objSettings.ptFontSize=11);var a="";a+="<div id='Inbox' class='RoundedBox'>",a+="<p style='text-align: center;'>",a+="<span>Message font size </span>",a+="<select id='SelEMFontSize' onchange='ChangeFontSize()'>";for(var b=10;b<18;b++)a+="<option value="+b+">"+b+"</option>";a+="</select>",a+="<br><br>",a+="Set Auto-Delete Default ",a+="<select id='AutoDelete' onchange='ChangeSettings()'>",a+="<option value='0'>Off</option>",a+="<option value='3600000'>1 hour</option>",a+="<option value='43200000'>12 hours</option>",a+="<option value='86400000'>1 day</option>",a+="<option value='259200000'>3 days</option>",a+="<option value='604800000'>7 days</option>",a+="<option value='1209600000'>14 days</option>",a+="<option value='2592000000'>30 days</option>",a+="<option value='15552000000'>180 days</option>",a+="<option value='31536000000'>1 year</option>",a+="</select></p><br>",a+="<a href='javascript:ShowPassphraseChanger()'>Change your passphrase?</a><br>",a+="<a href='javascript:LogOut()'>Log out</a>",a+="</div>",document.getElementById("LowerFrame").innerHTML=a,document.getElementById("SelEMFontSize").value=g_objSettings.ptFontSize,document.getElementById("AutoDelete").value=g_objSettings.nAutoDeleteDefault,document.getElementById("NavBar").innerHTML="<a href='javascript:ShowComposeEMail(-1)' title='Compose Mail'>&#9998;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowAbout(true)' title='About Eyes Only Mail'>&#9863;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowContacts()' title='Contacts'>&#9783;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - Settings",addToHomescreen({skipFirstVisit:!1,maxDisplayCount:0}),LoadPasswords(),LoadNotes()}function ChangeFontSize(){ChangeSettings()}function ChangeSettings(){g_objSettings.ptFontSize=document.getElementById("SelEMFontSize").value,document.getElementById("LowerFrame").style.fontSize=g_objSettings.ptFontSize+"pt",g_objSettings.nAutoDeleteDefault=Number(document.getElementById("AutoDelete").value);var a=JSON.stringify(g_objSettings);setCookie("Settings",a,999)}function LoadSettings(){var a=getCookie("Settings");g_objSettings=JSON.parse(a),document.getElementById("LowerFrame").style.fontSize=g_objSettings.ptFontSize+"pt"}function LogOut(){g_objUser={},g_objContacts=null,g_objMessages=null,g_aMessages=null,g_sMessageList="",setCookie("Credentials","",0),ShowLogInScreen(),document.getElementById("RHeader").innerHTML=" - Logged Out"}function ShowComposeEMail(a){InboxRefreshTimer(!1),RefreshContacts(!0);var b="";-1!=a?b="<input type='button' value='Cancel' class='Controls' style='' OnClick='ViewMessage("+a+")'><br>":(b="<input type='button' value='Cancel' class='Controls' style='' OnClick='ShowInbox()'><br>",document.getElementById("RHeader").innerHTML=" - Compose");var c="";c+="<div id='Inbox' class='RoundedBox'>",g_objCurrentMessage.AutoDelete&&(c+="<div style='display:inline-block; float: right;' onclick='ShowSetAdditionalOptions("+a+")' title='Options'>&#9719;&nbsp;&nbsp;&nbsp;</div> "),c+="<div style='display:inline-block;'><a href='javascript:ShowContactChooserScreen("+a+")'>To:</a></div> ",c+="<div id='To' style='display:inline-block;'></div><br>",c+="<div id='CCLine'>",c+="<div style='display:inline-block;'><a href='javascript:ShowContactChooserScreen("+a+")'>Cc:</a></div> ",c+="<div id='CC' style='display:inline-block;'></div><br>",c+="</div><div id='BCCLine'>",c+="<div style='display:inline-block;'><a href='javascript:ShowContactChooserScreen("+a+")'>Bcc:</a></div> ",c+="<div id='BCC' style='display:inline-block;'></div><br>",c+="</div>",c+="<input type='text' id='SMSubject' placeholder='Subject' value='' class='Controls' style='width: 96%;' maxlength='55' OnInput='OnChangeMessage()' OnKeyUp='OnChangeMessage()' OnChange='OnChangeMessage()' OnPaste='OnChangeMessage()'><br>",c+="<div id='htmlEditor'></div>",c+="<div class='CopyCentered'><input type='button' id='SendMessage' value='Send' class='Controls' style='' OnClick='SendMessages("+a+")'> ",c+=b,c+="</div>",-1!=a&&(c+="<br><input type='checkbox' id='IncludeQuote' checked='checked' OnChange='QuoteChange()'> Include Quote<br>",c+="<div id='Quote'>"+makeQuote(a)+"</div>"),c+="</div>",document.getElementById("LowerFrame").innerHTML=c;var d={};ShowComposeEMail.Editor=CKEDITOR.appendTo("htmlEditor",d,g_objCurrentMessage.sBody),document.getElementById("NavBar").innerHTML="<a href='javascript:ShowSetAdditionalOptions("+a+")' title='Set show-after date and/or auto-delete date'>&#9719;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowContacts()' title='Contacts'>&#9783;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("CCLine").style.display="none",document.getElementById("BCCLine").style.display="none",document.getElementById("SMSubject").focus(),g_objCurrentMessage.aToIDs.length||(document.getElementById("SendMessage").disabled=!0),setTimeout(function(){window.scrollTo(0,0)},700)}function DestroyEditor(){ShowComposeEMail.Editor&&(ShowComposeEMail.Editor.destroy(),ShowComposeEMail.Editor=null)}function Reply(a,b){var c="";b?(document.getElementById("RHeader").innerHTML=" - Reply All",g_objCurrentMessage.aToIDs=g_aMessages[a].aTo.slice(0),g_objCurrentMessage.aToIDs[g_objCurrentMessage.aToIDs.length]=g_aMessages[a].From,g_objCurrentMessage.aToIDs=removeDuplicates(g_objCurrentMessage.aToIDs),g_objCurrentMessage.aCCIDs=g_aMessages[a].aCc.slice(0),g_objCurrentMessage.aCCIDs=removeItem(g_aMessages[a].From,g_objCurrentMessage.aCCIDs)):(document.getElementById("RHeader").innerHTML=" - Reply",g_objCurrentMessage.aToIDs[0]||(g_objCurrentMessage.aToIDs[0]=g_aMessages[a].From)),c=g_aMessages[a].Subj,-1==c.search("Re: ")&&(c="Re: "+c);new Date(g_aMessages[a].Date);ShowComposeEMail(a),document.getElementById("SMSubject").value=c;for(var e=0,f=0,g="",h=[],i=[],j=0;j<g_objCurrentMessage.aToIDs.length;j++)g=getName(g_objCurrentMessage.aToIDs[j]),g&&(h[e]=g_objCurrentMessage.aToIDs[j],g_objCurrentMessage.aToNames[e++]=g);for(j=0;j<g_objCurrentMessage.aCCIDs.length;j++)g=getName(g_objCurrentMessage.aCCIDs[j]),g&&(i[f]=g_objCurrentMessage.aCCIDs[j],g_objCurrentMessage.aCCNames[f++]=g);g_objCurrentMessage.aToIDs=[],g_objCurrentMessage.aToIDs=h.slice(0),g_objCurrentMessage.aCCIDs=[],g_objCurrentMessage.aCCIDs=i.slice(0),g_objCurrentMessage.aBCCNames=[],document.getElementById("CCLine").style.display=g_objCurrentMessage.aCCIDs.length?"inline":"none",document.getElementById("BCCLine").style.display=g_objCurrentMessage.aBCCIDs.length?"inline":"none";var k="",l="",m="";k=g_objCurrentMessage.aToNames.join(", "),document.getElementById("To").innerHTML=k,l=g_objCurrentMessage.aCCNames.join(", "),document.getElementById("CC").innerHTML=l,m=g_objCurrentMessage.aBCCNames.join(", "),document.getElementById("BCC").innerHTML=m,document.getElementById("SendMessage").disabled=!1,ShowComposeEMail.Editor.focus()}function QuoteChange(){document.getElementById("Quote").style.display=document.getElementById("IncludeQuote").checked?"inline":"none"}function makeQuote(a){var b="";return b+="<div style='display: inline-block; float: left; width: 80%;'>",b+="<i>"+g_aMessages[a].ByLine+"</i>",b+="</div>",b+="<div style='display: inline-block; float: right;'><img src='http://EyesOnlyMail.com/Images/EOM45.png'></div>",b+="<br><br><br>",b+=g_aMessages[a].Body}function OnChangeMessage(){document.getElementById("SendMessage").disabled=!0,g_objCurrentMessage.sSubj=document.getElementById("SMSubject").value.trim(),g_objCurrentMessage.sBody=ShowComposeEMail.Editor.getData(),document.getElementById("SendMessage").disabled=!g_objCurrentMessage.aToIDs.length||!g_objCurrentMessage.sSubj}function DeleteMessage(a){if(confirm("Are you sure you want to delete this message?")){document.getElementById("NavBar").innerHTML="&#8629;&nbsp;&nbsp;&nbsp;&#9760;&nbsp;&nbsp;&nbsp;&#9776;&nbsp;&nbsp;&nbsp;";var b={};b.UserID=g_objUser.ID,b.MsgToDelete=g_aMessages[a].Date;var c=JSON.stringify(b);postFileFromServer("EOM.php","DelSM="+c,DelMessageCallback),document.getElementById("RHeader").innerHTML=" - Deleting..."}}function DelMessageCallback(a){a?(DestroyEditor(),ShowInbox()):alert("Error deleting message.  Please try again.")}function DelMessageSilentCallback(a){}function SendMessages(a){document.getElementById("RHeader").innerHTML=" - Sending..",document.getElementById("SendMessage").disabled=!0;var b={};b.aSendToIDs=[],b.aSendCcIDs=[],b.aSendBccIDs=[],b.aSendToIDs=g_objCurrentMessage.aToIDs,b.aSendCcIDs=g_objCurrentMessage.aCCIDs,b.aSendBccIDs=g_objCurrentMessage.aBCCIDs,b.sSubj=CurlyToStraightQuotes(document.getElementById("SMSubject").value.trim().replace(/(<([^>]+)>)/gi,"")),g_objCurrentMessage.sBody=ShowComposeEMail.Editor.getData(),b.sBody=g_objCurrentMessage.sBody.trim(),-1!==a&&document.getElementById("IncludeQuote").checked&&(b.sBody+="<br><br>"+makeQuote(a)),SendMessage(b)}function SendMessage(a){function k(a){a&&(document.getElementById("RHeader").innerHTML=" - Sent",clearCurrentAddressingArrays(),DestroyEditor(),ShowInbox())}for(var b=a.aSendToIDs.concat(a.aSendCcIDs,a.aSendBccIDs),c=0;c<b.length;c++){document.getElementById("RHeader").innerHTML=" - Sending... "+(c+1);for(var d="",e=0;e<g_objContacts.length;e++)if(b[c]==g_objContacts[e].ID){d=g_objContacts[e].PP;break}var f={},g=new Date;f.Date=g.valueOf(),f.From=g_objUser.ID,f.Tags=["Inbox"],f.DateRead=0,f.KillDate=g_objCurrentMessage.AutoDelete,f.ShowAfter=0,f.ByLine=makeByLine(g),f.aTo=a.aSendToIDs,f.aCc=a.aSendCcIDs;var h=[];isItemInArray(b[c],a.aSendBccIDs)&&(h[0]=b[c]),f.aBcc=h,f.Subj=a.sSubj,f.Body=a.sBody,f.Attachments=[];var i={};i.Date=f.Date,i.From=g_objUser.ID,i.To=b[c],i.Msg=encodeURIComponent(CryptoJS.AES.encrypt(JSON.stringify(f),d));var j=JSON.stringify(i);postFileFromServer("EOM.php","SendSM="+j,k)}}function ShowContactChooserScreen(a){g_objCurrentMessage.sSubj=document.getElementById("SMSubject").value,g_objCurrentMessage.sBody=ShowComposeEMail.Editor.getData(),DestroyEditor(),-1!==a&&(g_objCurrentMessage.bQuote=document.getElementById("IncludeQuote").checked),document.getElementById("NavBar").innerHTML="<a href='javascript:ChooseContacts("+a+")'>&#8678;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - Send To";var b="";b+="<div class='RoundedBox'>",b+="<form>",b+="<table style='line-height: 175%;'><tr><th>To</th><th>Cc</th><th>Bcc</th><th>NA</th><th></th></tr>";for(var c=0;c<g_objContacts.length;c++)b+="<td><input type='radio' value='"+g_objContacts[c].ID+"' id='CBTo"+g_objContacts[c].ID+"' name='N"+g_objContacts[c].ID+"'></td>",b+="<td><input type='radio' value='"+g_objContacts[c].ID+"' id='CBCc"+g_objContacts[c].ID+"' name='N"+g_objContacts[c].ID+"'></td>",b+="<td><input type='radio' value='"+g_objContacts[c].ID+"' id='CBBcc"+g_objContacts[c].ID+"' name='N"+g_objContacts[c].ID+"'></td>",b+="<td><input type='radio' value='"+g_objContacts[c].ID+"' id='CBNA"+g_objContacts[c].ID+"' name='N"+g_objContacts[c].ID+"'></td>",b+="<td>"+g_objContacts[c].Name+"</td></tr>";b+="</table><br>",b+="<input type='button' id='ChooseContactsBtn' value='Close' class='Controls' OnClick='ChooseContacts("+a+")'>",b+="</form>",b+="</div>",document.getElementById("LowerFrame").innerHTML=b;for(var d=0;d<g_objCurrentMessage.aToIDs.length;d++)document.getElementById("CBTo"+g_objCurrentMessage.aToIDs[d]).checked=!0;for(var e=0;e<g_objCurrentMessage.aCCIDs.length;e++)document.getElementById("CBCc"+g_objCurrentMessage.aCCIDs[e]).checked=!0;for(var f=0;f<g_objCurrentMessage.aBCCIDs.length;f++)document.getElementById("CBBcc"+g_objCurrentMessage.aBCCIDs[f]).checked=!0}function ChooseContacts(a){var b=0,c=0,d=0,e="",f="",g="",h=g_objCurrentMessage.AutoDelete,i=g_objCurrentMessage.sBody;clearCurrentAddressingArrays(),g_objCurrentMessage.AutoDelete=h,g_objCurrentMessage.sBody=i;for(var j=0;j<g_objContacts.length;j++)document.getElementById("CBTo"+g_objContacts[j].ID).checked?(g_objCurrentMessage.aToIDs[b]=g_objContacts[j].ID,g_objCurrentMessage.aToNames[b++]=g_objContacts[j].Name):document.getElementById("CBCc"+g_objContacts[j].ID).checked?(g_objCurrentMessage.aCCIDs[c]=g_objContacts[j].ID,g_objCurrentMessage.aCCNames[c++]=g_objContacts[j].Name):document.getElementById("CBBcc"+g_objContacts[j].ID).checked&&(g_objCurrentMessage.aBCCIDs[d]=g_objContacts[j].ID,g_objCurrentMessage.aBCCNames[d++]=g_objContacts[j].Name);ShowComposeEMail(a),e=g_objCurrentMessage.aToNames.join(", "),document.getElementById("To").innerHTML=e,f=g_objCurrentMessage.aCCNames.join(", "),document.getElementById("CC").innerHTML=f,g=g_objCurrentMessage.aBCCNames.join(", "),document.getElementById("BCC").innerHTML=g,document.getElementById("SMSubject").value=g_objCurrentMessage.sSubj,ShowComposeEMail.Editor.setData(g_objCurrentMessage.sBody),-1!==a&&(document.getElementById("IncludeQuote").checked=g_objCurrentMessage.bQuote,document.getElementById("Quote").style.display=document.getElementById("IncludeQuote").checked?"inline":"none"),document.getElementById("CCLine").style.display=g_objCurrentMessage.aCCIDs.length?"inline":"none",document.getElementById("BCCLine").style.display=g_objCurrentMessage.aBCCIDs.length?"inline":"none",OnChangeMessage()}function ShowSetAdditionalOptions(a){g_objCurrentMessage.sSubj=document.getElementById("SMSubject").value,g_objCurrentMessage.sBody=ShowComposeEMail.Editor.getData(),DestroyEditor(),-1!==a&&(g_objCurrentMessage.bQuote=document.getElementById("IncludeQuote").checked),document.getElementById("NavBar").innerHTML="<a href='javascript:SetAdditionalOptions("+a+")'>&#8678;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - Options";var b="";b+="<div class='RoundedBox'>",b+="<p style='text-align: center;'>Automatically delete message after ",b+="<select id='AutoDelete'>",b+="<option value='0'>Off</option>",b+="<option value='3600000'>1 hour</option>",b+="<option value='43200000'>12 hours</option>",b+="<option value='86400000'>1 day</option>",b+="<option value='259200000'>3 days</option>",b+="<option value='604800000'>7 days</option>",b+="<option value='1209600000'>14 days</option>",b+="<option value='2592000000'>30 days</option>",b+="<option value='15552000000'>180 days</option>",b+="<option value='31536000000'>1 year</option>",b+="</select></p><br>",b+="<p style='text-align: center;'><input type='button' id='SetAdditionalOptionsBtn' value='Close' class='Controls' OnClick='SetAdditionalOptions("+a+")'></p>",b+="</form>",b+="</div>",document.getElementById("LowerFrame").innerHTML=b,document.getElementById("AutoDelete").value=g_objCurrentMessage.AutoDelete}function SetAdditionalOptions(a){g_objCurrentMessage.AutoDelete=Number(document.getElementById("AutoDelete").value),ShowComposeEMail(a),sTo=g_objCurrentMessage.aToNames.join(", "),document.getElementById("To").innerHTML=sTo,sCC=g_objCurrentMessage.aCCNames.join(", "),document.getElementById("CC").innerHTML=sCC,sBCC=g_objCurrentMessage.aBCCNames.join(", "),document.getElementById("BCC").innerHTML=sBCC,document.getElementById("SMSubject").value=g_objCurrentMessage.sSubj,
ShowComposeEMail.Editor.setData(g_objCurrentMessage.sBody),-1!==a&&(document.getElementById("IncludeQuote").checked=g_objCurrentMessage.bQuote,document.getElementById("Quote").style.display=document.getElementById("IncludeQuote").checked?"inline":"none"),document.getElementById("CCLine").style.display=g_objCurrentMessage.aCCIDs.length?"inline":"none",document.getElementById("BCCLine").style.display=g_objCurrentMessage.aBCCIDs.length?"inline":"none",OnChangeMessage()}function ShowContacts(){InboxRefreshTimer(!1),DestroyEditor(),document.getElementById("NavBar").innerHTML="<a href='javascript:AddAContact()' title='Add a Contact'>&#43;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:RefreshContacts(false)' title='Refresh Contacts'>&#8635;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ChangeWords()' title='Set Words'>3</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - Contacts";for(var a="",b=0;b<g_objContacts.length;b++)a+="<div id='Contacts' class='RoundedBox'>",a+="<div class='ContactIcon' style='background-color: "+g_objContacts[b].Color+";'>"+g_objContacts[b].Name[0]+"</div>",a+="<div style='display: inline-block; margin-left: 5px;'>"+g_objContacts[b].Name+"</div>",a+="<div class='ContactNav'><a href='javascript:ShowEditContact("+b+")' title='Edit "+g_objContacts[b].Name+"?'>&#9881;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:MessageContact("+b+")' title='Send a message to "+g_objContacts[b].Name+"?'>&#9998;</a>&nbsp;&nbsp;&nbsp;</div>",a+="</div>";document.getElementById("LowerFrame").innerHTML=a}function GetContacts(a){function d(a){if(a){var b=CryptoJS.AES.decrypt(decodeURIComponent(a),g_objUser.PP),c=hex2a(b.toString());g_objContacts=JSON.parse(c),g_objContacts.sort(sort_by_name)}}var b={};b.ID=a,b.FileName="Contacts";var c=JSON.stringify(b);postFileFromServer("EOM.php","GetFile="+c,d)}function RefreshContacts(a){function d(b){function m(b){b&&!a&&ShowContacts()}a||(document.getElementById("RHeader").innerHTML=" - Contacts");var c=CryptoJS.AES.decrypt(decodeURIComponent(g_objUser.pWords),g_objUser.PP),d=hex2a(c.toString());if(b){a||(document.getElementById("RHeader").innerHTML=" - Contacts");for(var e=JSON.parse(b),f=0;f<e.length;f++){var g=CryptoJS.AES.decrypt(decodeURIComponent(e[f]),d),h=hex2a(g.toString()),i=g_objContacts.length,j={};j=JSON.parse(h),g_objContacts[i]=j;var k={};k.UserID=g_objUser.ID,k.NewContactsFile=encodeURIComponent(CryptoJS.AES.encrypt(JSON.stringify(g_objContacts),g_objUser.PP));var l=JSON.stringify(k);postFileFromServer("EOM.php","AddPendingContact="+l,m)}}}a||(document.getElementById("RHeader").innerHTML=" - Refreshing...");var b={};b.ID=g_objUser.ID,b.FileName="PendingContacts";var c=JSON.stringify(b);postFileFromServer("EOM.php","GetFile="+c,d)}function MessageContact(a){clearCurrentAddressingArrays(),g_objCurrentMessage.aToIDs[0]=g_objContacts[a].ID,g_objCurrentMessage.aToNames[0]=g_objContacts[a].Name,ShowComposeEMail(-1);var b=g_objCurrentMessage.aToNames.join(", ");document.getElementById("To").innerHTML=b,document.getElementById("SendMessage").disabled=!0}function ShowEditContact(a){document.getElementById("RHeader").innerHTML=" - Edit Contact",document.getElementById("NavBar").innerHTML="<a href='javascript:ShowContacts()' title='Contacts'>&#9783;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;";var b="";b+="<datalist id='colors'>";for(var c=0;c<g_objSite.Colors.length;c++)b+="<option value='"+g_objSite.Colors[c]+"'>";b+="</datalist>",b+="<div class='RoundedBox' style='text-align: center;'>Edit "+g_objContacts[a].Name+"<br><br>",b+="<input type='text' id='Name' placeholder='Name' class='Controls' style='width: 96%;' maxlength='40' value='"+g_objContacts[a].Name+"' title='' OnInput='OnEditContact()' OnKeyUp='OnEditContact()' OnChange='OnEditContact()' OnPaste='OnEditContact()'><br><br>",b+="<input type='color' id='Color' placeholder='Color' class='Controls' style='' maxlength='8' value='"+g_objContacts[a].Color+"' list='colors' title='Change contact color?' OnInput='OnEditContact()' OnKeyUp='OnEditContact()' OnChange='OnEditContact()' OnPaste='OnEditContact()'><br><br>",b+="<p id='Feedback' class='CopyCentered' style='font-size: 75%;'></p>",b+="<input type='button' id='SaveContactBtn' disabled='true' value='Save' class='Controls' OnClick='SaveContactBtn("+a+")'>",b+="</div>",document.getElementById("LowerFrame").innerHTML=b}function OnEditContact(){var a=document.getElementById("Name").value.trim(),b=document.getElementById("Color").value.trim();document.getElementById("SaveContactBtn").disabled=!a||!b}function SaveContactBtn(a){function d(a){a&&ShowContacts()}document.getElementById("SaveContactBtn").disabled=!0,g_objContacts[a].Name=document.getElementById("Name").value.trim(),g_objContacts[a].Color=document.getElementById("Color").value.trim(),document.getElementById("RHeader").innerHTML=" - Saving.",g_objUser.ID===g_objContacts[a].ID&&SaveUserNameColor(g_objContacts[a].Name,g_objContacts[a].Color);var b={};b.UserID=g_objUser.ID,b.FileName="Contacts",g_objContacts.sort(sort_by_name),b.NewContactsFile=encodeURIComponent(CryptoJS.AES.encrypt(JSON.stringify(g_objContacts),g_objUser.PP));var c=JSON.stringify(b);postFileFromServer("EOM.php","WriteDataFile="+c,d)}function SaveUserNameColor(a,b){var c=CryptoJS.AES.decrypt(decodeURIComponent(g_objUser.pWords),g_objUser.PP);c=hex2a(c.toString()),g_objUser.wName=encodeURIComponent(CryptoJS.AES.encrypt(a,c)),g_objUser.pName=encodeURIComponent(CryptoJS.AES.encrypt(a,g_objUser.PP)),g_objUser.wColor=encodeAES(b,c),g_objUser.pColor=encodeAES(b,g_objUser.PP),document.getElementById("RHeader").innerHTML=" - Saving..",ChangeUserData(c,!1)}function AddAContact(){RefreshContacts(!0),postFileFromServer("EOM.php","GetUsers=GetUsers",UsersListCallback),document.getElementById("RHeader").innerHTML=" - Add Contact",document.getElementById("NavBar").innerHTML="<a href='javascript:ShowContacts()' title='Contacts'>&#9783;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ChangeWords()' title='Set Words'>3</a>&nbsp;&nbsp;&nbsp;";var a="";a+="<div class='RoundedBox' style='text-align: center;'>Enter the three secret words you got from the contact you would like to add...<br><br>",a+="<input type='text' id='Word1' placeholder='Word #1' class='Controls' style='width: 96%;' value='' title='' OnInput='OnChangeWords()' OnKeyUp='OnChangeWords()' OnChange='OnChangeWords()' OnPaste='OnChangeWords()'><br><br>",a+="<input type='text' id='Word2' placeholder='Word #2' class='Controls' style='width: 96%;' value='' title='' OnInput='OnChangeWords()' OnKeyUp='OnChangeWords()' OnChange='OnChangeWords()' OnPaste='OnChangeWords()'><br><br>",a+="<input type='text' id='Word3' placeholder='Word #3' class='Controls' style='width: 96%;' value='' title='' OnInput='OnChangeWords()' OnKeyUp='OnChangeWords()' OnChange='OnChangeWords()' OnPaste='OnChangeWords()'><br><br>",a+="<p id='Feedback' class='CopyCentered' style='font-size: 75%;'></p>",a+="<input type='button' id='FindContactBtn' disabled='true' value='Find Contact' class='Controls' OnClick='FindContactBtn()'>",a+="</div>",document.getElementById("LowerFrame").innerHTML=a}function OnChangeWords(){document.getElementById("FindContactBtn").disabled=!0;var a=document.getElementById("Word1").value.trim(),b=document.getElementById("Word2").value.trim(),c=document.getElementById("Word3").value.trim();document.getElementById("FindContactBtn").disabled=!(a&&b&&c)}function FindContactBtn(){document.getElementById("FindContactBtn").disabled=!0;for(var a=document.getElementById("Word1").value.trim().toLowerCase(),b=document.getElementById("Word2").value.trim().toLowerCase(),c=document.getElementById("Word3").value.trim().toLowerCase(),d=a+"*&^%$*"+b+"*&^%$*"+c,e=sha3_512(d),f="",g="",h=0;h<g_objUsers.Users.length;h++){var i=decodeURIComponent(g_objUsers.Users[h].hWords);if(e===i){var j=CryptoJS.AES.decrypt(decodeURIComponent(g_objUsers.Users[h].wWordsExpiration),d);j=Number(hex2a(j.toString()));var k=new Date;if(k.valueOf()<j){var l=CryptoJS.AES.decrypt(decodeURIComponent(g_objUsers.Users[h].wName),d);f=hex2a(l.toString()),g=g_objUsers.Users[h].ID;var m=decodeAES(g_objUsers.Users[h].wColor,d);MakeAddContactFound(f,g,d,m);break}}}g||alert("Contact not found.  Try again?")}function MakeAddContactFound(a,b,c,d){document.getElementById("NavBar").innerHTML="<a href='javascript:ShowContacts()' title='Contacts'>&#9783;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:AddAContact()' title='Add Contact'>&#43;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ChangeWords()' title='Set Words'>3</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;";for(var e=!1,f=0;f<g_objContacts.length;f++)if(g_objContacts[f].ID==b){e=!0;break}var g="";g+="<div class='RoundedBox' style='text-align: center;'>Contact found...",g+="<br><br>",g+="<b>"+a+"</b>",e&&(g+=" is already in your contacts list"),g+="<br><br>",e||(g+="<input type='button' id='AddFoundContactBtn' value='Add Contact' class='Controls' OnClick='AddFoundContactBtn(\""+a+'", "'+b+'", "'+c+'", "'+d+"\")'>"),g+="</div>",document.getElementById("LowerFrame").innerHTML=g}function AddFoundContactBtn(a,b,c,d){function l(a){a&&ShowContacts()}for(var e=0;e<g_objContacts.length;e++)if(g_objContacts[e].ID==b)return alert(g_objContacts[e].Name+" is already in your contacts list"),!1;var f={};f.NewContactID=b,f.UserID=g_objUser.ID;var g=g_objContacts.length;g_objContacts[g]={},g_objContacts[g].ID=b,g_objContacts[g].Name=a,g_objContacts[g].PP=sha3_512(MakeRandomCode(40)+" "+MakeRandomCode(40)+" "+MakeRandomCode(40)),g_objContacts[g].PP=g_objContacts[g].PP.trim();var h=g_objContacts[g].PP;g_objContacts[g].Color=d,g_objContacts[g].bActive=!0,f.NewContactsFile=encodeURIComponent(CryptoJS.AES.encrypt(JSON.stringify(g_objContacts),g_objUser.PP));var i={};i.ID=g_objUser.ID;var j=CryptoJS.AES.decrypt(decodeURIComponent(g_objUser.pName),g_objUser.PP);i.Name=hex2a(j.toString()),i.PP=h,f.PendingEntry=encodeURIComponent(CryptoJS.AES.encrypt(JSON.stringify(i),c));var k=JSON.stringify(f);postFileFromServer("EOM.php","AddContact="+k,l)}function ChangeWords(){RefreshContacts(!0),setTimeout(function(){GetContacts(g_objUser.ID)},3e3);var a=CryptoJS.AES.decrypt(decodeURIComponent(g_objUser.pWords),g_objUser.PP);a=hex2a(a.toString());var b=CryptoJS.AES.decrypt(decodeURIComponent(g_objUser.wWordsExpiration),a);b=Number(hex2a(b.toString()));var c=a.split("*&^%$*"),d=new Date,e=0;b<Number(d.valueOf())?(c[0]=getRandomWord(),c[1]=getRandomWord(),c[2]=getRandomWord()):e=Math.round((b-Number(d.valueOf()))/1e3),postFileFromServer("EOM.php","GetUsers=GetUsers",UsersListCallback),document.getElementById("RHeader").innerHTML=" - Your Words",document.getElementById("NavBar").innerHTML="<a href='javascript:ShowContacts()' title='Contacts'>&#9783;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;";var f="";if(f+="<div class='RoundedBox' style='text-align: center;'>The three secret words you give to people who would like to add you to their contacts list...<br><br>",f+="<input type='text' id='Word1' placeholder='Word #1' class='Controls' style='width: 96%;' value='"+c[0]+"' title='' OnInput='OnChangeYourWords()' OnKeyUp='OnChangeYourWords()' OnChange='OnChangeYourWords()' OnPaste='OnChangeYourWords()'><br><br>",f+="<input type='text' id='Word2' placeholder='Word #2' class='Controls' style='width: 96%;' value='"+c[1]+"' title='' OnInput='OnChangeYourWords()' OnKeyUp='OnChangeYourWords()' OnChange='OnChangeYourWords()' OnPaste='OnChangeYourWords()'><br><br>",f+="<input type='text' id='Word3' placeholder='Word #3' class='Controls' style='width: 96%;' value='"+c[2]+"' title='' OnInput='OnChangeYourWords()' OnKeyUp='OnChangeYourWords()' OnChange='OnChangeYourWords()' OnPaste='OnChangeYourWords()'><br><br>",f+="<p>These words expire in ",e<1)f+="<select id='SelExpirationTime'>",f+="<option value ='600000'>10 minutes</option>",f+="<option value ='1800000'>30 minutes</option>",f+="<option value ='3600000'>60 minutes</option>",f+="<option value ='10800000'>3 hours</option>",f+="</select></p>";else{var g=new Date(b);f+="<span OnClick='UpdateWordsTime()' id='TimeUntilExp'>"+TheTimeUntil(g)+"</span></p>"}f+="<p id='Feedback' class='CopyCentered' style='font-size: 75%;'></p>",1>e&&(f+="<input type='button' id='NewWordsBtn' value='New Words' class='Controls' OnClick='NewWords()'> <input type='button' id='ChangeYourWordsBtn' disabled='true' value='Set Words' class='Controls' OnClick='ChangeYourWordsBtnPushed()'>"),f+="</div>",document.getElementById("LowerFrame").innerHTML=f,OnChangeYourWords()}function NewWords(){document.getElementById("Word1").value=getRandomWord(),document.getElementById("Word2").value=getRandomWord(),document.getElementById("Word3").value=getRandomWord(),OnChangeYourWords()}function UpdateWordsTime(){var a=decodeAES(g_objUser.pWords,g_objUser.PP),b=Number(decodeAES(g_objUser.wWordsExpiration,a)),c=new Date,d=Math.round((b-Number(c.valueOf()))/1e3),e=new Date(b);d>0?document.getElementById("TimeUntilExp").innerHTML=TheTimeUntil(e):ChangeWords()}function OnChangeYourWords(){document.getElementById("ChangeYourWordsBtn").disabled=!0,document.getElementById("Word1").style.backgroundColor="white",document.getElementById("Word2").style.backgroundColor="white",document.getElementById("Word3").style.backgroundColor="white",document.getElementById("Feedback").innerHTML="";var a=document.getElementById("Word1").value.trim(),b=document.getElementById("Word2").value.trim(),c=document.getElementById("Word3").value.trim();document.getElementById("ChangeYourWordsBtn").disabled=!(a&&b&&c)}function ChangeYourWordsBtnPushed(){document.getElementById("RHeader").innerHTML=" - Changing...",document.getElementById("ChangeYourWordsBtn").disabled=!0,document.getElementById("Feedback").innerHTML="<span style='color: red;'>Checking availablity...</span>";for(var a=document.getElementById("Word1").value.trim().toLowerCase(),b=document.getElementById("Word2").value.trim().toLowerCase(),c=document.getElementById("Word3").value.trim().toLowerCase(),d=a+"*&^%$*"+b+"*&^%$*"+c,e=sha3_512(d),f=0;f<g_objUsers.Users.length;f++)if(e===g_objUsers.Users[f].hWords){var g=CryptoJS.AES.decrypt(decodeURIComponent(g_objUsers.Users[f].wWordsExpiration),d);g=Number(hex2a(g.toString()));var h=new Date;if(h.valueOf()<g)return document.getElementById("Word1").style.backgroundColor="pink",document.getElementById("Word2").style.backgroundColor="pink",document.getElementById("Word3").style.backgroundColor="pink",document.getElementById("Feedback").innerHTML="<span style='color: red;'>Sorry, those three words are already taken.  Try again?</span>",document.getElementById("ChangeYourWordsBtn").disabled=!0,!1}document.getElementById("Feedback").innerHTML="<span style='color: green;'>Available...</span>",ChangeUserData(d,!0)}function ChangeUserData(a,b){function j(a){a?(g_objUser.hWords=e.hWords,g_objUser.pWords=e.pWords,document.getElementById("RHeader").innerHTML=" - Saved.",ShowContacts(),alert("Success:  changed.")):alert("Error:  try again.")}var c=CryptoJS.AES.decrypt(decodeURIComponent(g_objUser.pName),g_objUser.PP),d=hex2a(c.toString()),e={};if(e.hUN=encodeURIComponent(sha3_512(g_objUser.UN)),e.hPP=encodeURIComponent(sha3_512(g_objUser.PP)),g_objUser.hWords=e.hWords=encodeURIComponent(sha3_512(a)),g_objUser.pWords=e.pWords=encodeURIComponent(CryptoJS.AES.encrypt(a,g_objUser.PP)),e.wWordsExpiration=encodeURIComponent(g_objUser.wWordsExpiration),b){var f=new Date,g=Number(document.getElementById("SelExpirationTime").value)+Number(f.valueOf());g_objUser.wWordsExpiration=e.wWordsExpiration=encodeURIComponent(CryptoJS.AES.encrypt(g.toString(),a))}g_objUser.wName=e.wName=encodeURIComponent(CryptoJS.AES.encrypt(d,a)),e.pName=encodeURIComponent(CryptoJS.AES.encrypt(d,g_objUser.PP)),e.ID=g_objUser.ID,e.Salt=g_objUser.Salt,e.pColor=encodeURIComponent(g_objUser.pColor);var h=decodeAES(g_objUser.pColor,g_objUser.PP);e.wColor=encodeAES(h,a),document.getElementById("Feedback").innerHTML="<span style='color: green;'>Standby...</span>";var i=JSON.stringify(e);document.getElementById("RHeader").innerHTML=" - Saving...",postFileFromServer("EOM.php","ChangeUserData="+i,j)}function MarkMessageRead(a,b){function i(a){a&&(document.getElementById("From").style.fontWeight=b?400:600,document.getElementById("Subj").style.fontWeight=b?400:600)}var c=new Date;b?g_aMessages[a].DateRead=c.valueOf():(document.getElementById("MarkedRead")&&(document.getElementById("MarkedRead").style.display="none"),g_aMessages[a].DateRead=0);for(var d="",e=0;e<g_objContacts.length;e++)if(g_aMessages[a].From==g_objContacts[e].ID){d=g_objContacts[e].PP;break}var f={};f.Date=g_aMessages[a].Date,f.From=g_aMessages[a].From,f.To=g_aMessages[a].To,f.Msg=encodeURIComponent(CryptoJS.AES.encrypt(JSON.stringify(g_aMessages[a]),d));var g={};g.UserID=g_objUser.ID,g.FileName="Message",g.Data=JSON.stringify(f);var h=JSON.stringify(g);postFileFromServer("EOM.php","WriteDataFile="+h,i)}function ShowMenuOfApps(){if(g_objUser.PP){InboxRefreshTimer(!1),document.getElementById("NavBar").innerHTML="<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - Menu";var a="";a+="<div class='RoundedBox'>",a+="<p style='text-align: center;'>",a+="<a href='javascript:ShowInbox()' title='Inbox'>Inbox</a><br>",a+="<a href='javascript:ShowNotesList()' title='Notes'>Notes</a><br>",a+="<a href='javascript:ShowPasswordsList()' title='Password Manager'>Password Manager</a><br>",a+="</p>",a+="</div>",document.getElementById("LowerFrame").innerHTML=a,LoadPasswords(),LoadNotes()}}function LoadPasswords(){function c(a){if(a){var b=decodeAES(a,g_objUser.PP);g_objPasswords=JSON.parse(b)}else g_objPasswords.List=[]}var a={};a.FileName="Passwords",a.ID=g_objUser.ID;var b=JSON.stringify(a);postFileFromServer("EOM.php","GetFile="+b,c)}function ShowPasswordsList(){document.getElementById("NavBar").innerHTML="<a href='javascript:ShowPasswordEntryDetails(-1)' title='Add a password'>+</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowPWExport()' title='Export Passwords'>&#x219F;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowNotesList()' title='Notes'>&#9835;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - Passwords";var a="";if(a+="<div class='RoundedBox'>",a+="<p>",g_objPasswords.List.length)for(var b=0;b<g_objPasswords.List.length;b++)a+="<a href='javascript:ShowPasswordEntryDetails("+b+")'>"+g_objPasswords.List[b].PWEntryName+"</a><br>";else a+="<p style='text-align: center;'>You have no username/password entries.<br><a href='javascript:ShowPasswordEntryDetails(-1)'>Add one?</a></p>";a+="</p>",a+="</div>",document.getElementById("LowerFrame").innerHTML=a}function ShowPasswordEntryDetails(a){var b="";-1!=a&&(b+="<a href='javascript:DeletePWEntry("+a+")' title='Delete'>&#9760;</a>&nbsp;&nbsp;&nbsp;"),b+="<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("NavBar").innerHTML=b,document.getElementById("RHeader").innerHTML=-1==a?" - Add Entry":" - Entry";var c="";c+="<div class='RoundedBox'>",c+="<p style='text-align: center;'>",c+="<input id='PWEntryName' type='text' placeholder='App Name/URL' maxlength='300' class='Controls' style='width: 96%;' value='' OnInput='OnChangePWEntry()' OnKeyUp='OnChangePWEntry()' OnChange='OnChangePWEntry()' OnPaste='OnChangePWEntry()'><br>",c+="<input id='PWEntryUserName' type='text' placeholder='User Name/Email' maxlength='300' class='Controls' style='width: 96%;' value='' OnInput='OnChangePWEntry()' OnKeyUp='OnChangePWEntry()' OnChange='OnChangePWEntry()' OnPaste='OnChangePWEntry()'><br>",c+="<input id='PWEntryPassword' type='text' placeholder='Password/Passphrase' maxlength='300' class='Controls' style='width: 71%;' value='' OnInput='OnChangePWEntry()' OnKeyUp='OnChangePWEntry()' OnChange='OnChangePWEntry()' OnPaste='OnChangePWEntry()'> ",c+="<input type='button' id='GenPW' value='Suggest' disabled='true' class='Controls' style='width: 25%;' OnClick='GeneratePW()'><br>",c+="<textarea id='PWEntryNotes' placeholder='Notes' class='ComposeBodyControl Controls' style='width: 96%;' value='' OnInput='OnChangePWEntry()' OnKeyUp='OnChangePWEntry()' OnChange='OnChangePWEntry()' OnPaste='OnChangePWEntry()'></textarea>",c+="<input type='button' value='Cancel' class='Controls' OnClick='ShowPasswordsList()'> ",c+="<input type='button' id='SavePWEntry' value='Save' disabled='true' class='Controls' OnClick='SavePasswordEntry("+a+")'>",c+="</p>",c+="</div>",document.getElementById("LowerFrame").innerHTML=c,-1!=a&&(document.getElementById("PWEntryName").value=g_objPasswords.List[a].PWEntryName,document.getElementById("PWEntryUserName").value=g_objPasswords.List[a].PWEntryUserName,document.getElementById("PWEntryPassword").value=g_objPasswords.List[a].PWEntryPassword,document.getElementById("PWEntryNotes").value=g_objPasswords.List[a].PWEntryNotes)}function DeletePWEntry(a){function f(a){}if(confirm("Are you sure you want to delete "+g_objPasswords.List[a].PWEntryName+"?")){g_objPasswords.List.splice(a,1),g_objPasswords.List.sort(sort_passwords);var b=JSON.stringify(g_objPasswords),c=encodeAES(b,g_objUser.PP),d={};d.FileName="Passwords",d.UserID=g_objUser.ID,d.PasswordsFile=c;var e=JSON.stringify(d);postFileFromServer("EOM.php","WriteDataFile="+e,f),ShowPasswordsList()}}function GeneratePW(){document.getElementById("PWEntryPassword").value=MakeRandomCode(30)}function OnChangePWEntry(){document.getElementById("SavePWEntry").disabled=!document.getElementById("PWEntryName").value.trim(),document.getElementById("GenPW").disabled=!!document.getElementById("PWEntryPassword").value.trim()}function SavePasswordEntry(a){function g(a){}var b=-1==a?g_objPasswords.List.length:a;g_objPasswords.List[b]={},g_objPasswords.List[b].PWEntryName=document.getElementById("PWEntryName").value.trim(),g_objPasswords.List[b].PWEntryUserName=document.getElementById("PWEntryUserName").value.trim(),g_objPasswords.List[b].PWEntryPassword=document.getElementById("PWEntryPassword").value.trim(),g_objPasswords.List[b].PWEntryNotes=document.getElementById("PWEntryNotes").value.trim(),g_objPasswords.List.sort(sort_passwords);var c=JSON.stringify(g_objPasswords),d=encodeAES(c,g_objUser.PP),e={};e.FileName="Passwords",e.UserID=g_objUser.ID,e.PasswordsFile=d;var f=JSON.stringify(e);postFileFromServer("EOM.php","WriteDataFile="+f,g),ShowPasswordsList()}function ShowPWExport(){document.getElementById("NavBar").innerHTML="<a href='javascript:ShowPasswordsList()' title='Inbox'>&#8592;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - Export";var a="";a+="<div class='RoundedBox'>",a+="<p style='text-align: center;'>",a+="<a href='javascript:SavePWExportText()'>Export as Text</a><br>",a+="<a href='javascript:SavePWExportJSON()'>Export as JSON</a>",a+="</p>",a+="<textarea id='PWExport' class='Controls' style='width: 96%; height: 400px;'></textarea>",a+="<p id='SavePassword' style='text-align: center;'></p>",a+="</div>",document.getElementById("LowerFrame").innerHTML=a}function SavePWExportJSON(){var a=JSON.stringify(g_objPasswords.List);document.getElementById("PWExport").value=a,document.getElementById("SavePassword").innerHTML="<a href='javascript:SavePWJSON()'>Save as JSON</a>"}function SavePWJSON(){var a=document.getElementById("PWExport").value;saveTextAsFile(a,"Passwords.json")}function SavePWExportText(){for(var a="",b=0;b<g_objPasswords.List.length;b++)a+=g_objPasswords.List[b].PWEntryName+"\n",g_objPasswords.List[b].PWEntryUserName&&(a+=g_objPasswords.List[b].PWEntryUserName+"\n"),g_objPasswords.List[b].PWEntryPassword&&(a+=g_objPasswords.List[b].PWEntryPassword+"\n"),a+=g_objPasswords.List[b].PWEntryNotes+"\n\n";document.getElementById("PWExport").value=a,document.getElementById("SavePassword").innerHTML="<a href='javascript:SavePWText()'>Save as text</a>"}function SavePWText(){var a=document.getElementById("PWExport").value;saveTextAsFile(a,"Passwords.txt")}function LoadNotes(){function c(a){if(a){var b=decodeAES(a,g_objUser.PP);g_objNotes=JSON.parse(b)}else g_objNotes.List=[]}var a={};a.FileName="Notes",a.ID=g_objUser.ID;var b=JSON.stringify(a);postFileFromServer("EOM.php","GetFile="+b,c)}function ShowNotesList(){DestroyNoteEditor(),document.getElementById("NavBar").innerHTML="<a href='javascript:ShowNotesEntryDetails(-1)' title='Add a note'>+</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowNotesExport()' title='Export Notes'>&#x219F;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowPasswordsList()' title='Password Manager'>*</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - Notes";var a="";if(a+="<div class='RoundedBox'>",a+="<p>",g_objNotes.List.length)for(var b=0;b<g_objNotes.List.length;b++)a+="<a href='javascript:ShowNotesEntryDetails("+b+")'>"+g_objNotes.List[b].Title+"</a><br>";else a+="<p style='text-align: center;'>You have no notes.<br><a href='javascript:ShowNotesEntryDetails(-1)'>Add one?</a></p>";a+="</p>",a+="</div>",document.getElementById("LowerFrame").innerHTML=a}function ShowNotesEntryDetails(a){var b="";-1!=a&&(b+="<a href='javascript:DeleteNotesEntry("+a+")' title='Delete'>&#9760;</a>&nbsp;&nbsp;&nbsp;"),b+="<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("NavBar").innerHTML=b,document.getElementById("RHeader").innerHTML=-1==a?" - Add Note":" - Note";var c="";c+="<div class='RoundedBox'>",c+="<p style='text-align: center;'>",c+="<input id='NoteTitle' type='text' placeholder='Note title' maxlength='300' class='Controls' style='width: 96%;' value='' OnInput='OnChangeNoteEntry()' OnKeyUp='OnChangeNoteEntry()' OnChange='OnChangeNoteEntry()' OnPaste='OnChangeNoteEntry()'>",c+="</p>",c+="<div id='NoteText' style='width: 96%; margin-right: auto; margin-left: auto;'></div>",c+="<p style='text-align: center;'>",c+="<input type='button' value='Cancel' class='Controls' OnClick='ShowNotesList()'> ",c+="<input type='button' id='SaveNoteEntry' value='Save' disabled='true' class='Controls' OnClick='SaveNoteEntry("+a+")'>",c+="</p>",c+="</div>",document.getElementById("LowerFrame").innerHTML=c;var d={extraPlugins:"onchange"};-1!=a?(document.getElementById("NoteTitle").value=g_objNotes.List[a].Title,ShowNotesEntryDetails.Editor=CKEDITOR.appendTo("NoteText",d,g_objNotes.List[a].Body),document.getElementById("SaveNoteEntry").disabled=!1):ShowNotesEntryDetails.Editor=CKEDITOR.appendTo("NoteText",d,"")}function DestroyNoteEditor(){ShowNotesEntryDetails.Editor&&(ShowNotesEntryDetails.Editor.destroy(),ShowNotesEntryDetails.Editor=null)}function OnChangeNoteEntry(){document.getElementById("SaveNoteEntry").disabled=!document.getElementById("NoteTitle").value.trim()}function SaveNoteEntry(a){function g(a){}var b=-1==a?g_objNotes.List.length:a;g_objNotes.List[b]={},g_objNotes.List[b].Title=document.getElementById("NoteTitle").value.trim(),g_objNotes.List[b].Body=ShowNotesEntryDetails.Editor.getData(),g_objNotes.List.sort(function(a,b){var c=a.Title.toLowerCase(),d=b.Title.toLowerCase();return c.localeCompare(d)});var c=JSON.stringify(g_objNotes),d=encodeAES(c,g_objUser.PP),e={};e.FileName="Notes",e.UserID=g_objUser.ID,e.NotesFile=d;var f=JSON.stringify(e);postFileFromServer("EOM.php","WriteDataFile="+f,g),ShowNotesList()}function DeleteNotesEntry(a){function f(a){}if(confirm("Are you sure you want to delete "+g_objNotes.List[a].Title+"?")){g_objNotes.List.splice(a,1);var b=JSON.stringify(g_objNotes),c=encodeAES(b,g_objUser.PP),d={};d.FileName="Notes",d.UserID=g_objUser.ID,d.NotesFile=c;var e=JSON.stringify(d);postFileFromServer("EOM.php","WriteDataFile="+e,f),ShowNotesList()}}function ShowNotesExport(){document.getElementById("NavBar").innerHTML="<a href='javascript:ShowNotesList()' title='Notes List'>&#8592;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - Export";var a="";a+="<div class='RoundedBox'>",a+="<p style='text-align: center;'>",a+="<a href='javascript:SaveNotesExportText()'>Export as Text</a><br>",a+="<a href='javascript:SaveNotesExportJSON()'>Export as JSON</a>",a+="</p>",a+="<textarea id='NotesExport' class='Controls' style='width: 96%; height: 400px;'></textarea>",a+="<p id='SaveNotes' style='text-align: center;'></p>",a+="</div>",document.getElementById("LowerFrame").innerHTML=a}function SaveNotesExportJSON(){var a=JSON.stringify(g_objNotes.List);document.getElementById("NotesExport").value=a,document.getElementById("SaveNotes").innerHTML="<a href='javascript:SaveNotesJSON()'>Save as JSON</a>"}function SaveNotesExportText(){for(var a="",b=0;b<g_objNotes.List.length;b++)a+=g_objNotes.List[b].Title+"\n",a+=g_objNotes.List[b].Body+"\n\n";document.getElementById("NotesExport").value=a,document.getElementById("SaveNotes").innerHTML="<a href='javascript:SaveNotesText()'>Save as text</a>"}function SaveNotesJSON(){var a=document.getElementById("NotesExport").value;saveTextAsFile(a,"Notes.json")}function SaveNotesText(){var a=document.getElementById("NotesExport").value;saveTextAsFile(a,"Notes.txt")}function ShowPassphraseChanger(){document.getElementById("NavBar").innerHTML="<a href='javascript:ShowSettings()' title='Settings'>&#9881;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowAbout(true)' title='About Eyes Only Mail'>&#9863;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowContacts()' title='Contacts'>&#9783;</a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowInbox()' title='Inbox'>&#9776;</a>&nbsp;&nbsp;&nbsp;",document.getElementById("RHeader").innerHTML=" - Passphrase";var a="";a+="<div class='RoundedBox'>",a+="<p style='text-align: center;'>",a+="Change your passphrase...<br>",a+="<input type='password' id='OldPP' placeholder='Old passphrase' class='Controls' style='width: 96%;' value='' OnInput='OnChangePPForm()' OnKeyUp='OnChangePPForm()' OnChange='OnChangePPForm()' OnPaste='OnChangePPForm()'><br>",a+="<input type='password' id='PP' placeholder='New passphrase' class='Controls' style='width: 96%;' value='' OnInput='OnChangePPForm()' OnKeyUp='OnChangePPForm()' OnChange='OnChangePPForm()' OnPaste='OnChangePPForm()'><br>",a+="<input type='password' id='PP2' placeholder='Confirm passphrase' class='Controls' style='width: 96%;' value='' OnInput='OnChangePPForm()' OnKeyUp='OnChangePPForm()' OnChange='OnChangePPForm()' OnPaste='OnChangePPForm()'><br><br>",a+="<span id='Feedback' class='CopyCentered' style='font-size: 75%;'>Enter old passphrase</span><br><br>",a+="<input type='button' id='ChangePPBtn' value='Change' disabled='true' class='Controls' OnClick='ChangePP()'>",a+="</p>",a+="</div>",document.getElementById("LowerFrame").innerHTML=a}function OnChangePPForm(){var a=document.getElementById("OldPP").value.trim(),b=document.getElementById("PP").value.trim(),c=document.getElementById("PP2").value.trim();document.getElementById("ChangePPBtn").disabled=!0,a?b.length<8?document.getElementById("Feedback").innerHTML="Enter new passphrase":c.length<8?document.getElementById("Feedback").innerHTML="Confirm new passphrase":b!=c?document.getElementById("Feedback").innerHTML="New passphrases don't match":b==c&&a&&b.length>7&&(document.getElementById("ChangePPBtn").disabled=!1,document.getElementById("Feedback").innerHTML=""):document.getElementById("Feedback").innerHTML="Enter old passphrase"}function ChangePP(){function m(a){g_objUser.PP=c,alert("Passphrase changed successfully"),ShowSettings()}var a=document.getElementById("OldPP").value.trim(),b=sha3_256(a),c="";if(b!=g_objUser.PP)alert("Old passphrase is incorrect"),document.getElementById("OldPP").value="",document.getElementById("PP").value="",document.getElementById("PP2").value="",
document.getElementById("Feedback").innerHTML="Enter old passphrase";else if(confirm("Change your passphrase?")){c=document.getElementById("PP").value.trim();var d=sha3_256(c),e={};e.ID=g_objUser.ID,e.hPP=encodeURIComponent(sha3_512(d));var f=decodeAES(g_objUser.pWords,g_objUser.PP);e.pWords=encodeAES(f,d);var g=decodeAES(g_objUser.pName,g_objUser.PP);e.pName=encodeAES(g,d);var h=decodeAES(g_objUser.pColor,g_objUser.PP);e.pColor=encodeAES(h,d);var i=JSON.stringify(g_objContacts);e.pContacts=encodeAES(i,d);var j=JSON.stringify(g_objPasswords);e.pPasswords=encodeAES(j,d);var k=JSON.stringify(g_objNotes);e.pNotes=encodeAES(k,d);var l=JSON.stringify(e);postFileFromServer("EOM.php","ChangeUserPP="+l,m)}}function saveTextAsFile(a,b){var c=new Blob([a],{type:"text/plain"}),d=window.URL.createObjectURL(c),e=document.createElement("a");e.download=b,e.innerHTML="Download File",e.href=d,e.onclick=destroyClickedElement,e.style.display="none",document.body.appendChild(e),e.click()}function destroyClickedElement(a){document.body.removeChild(a.target)}function CurlyToStraightQuotes(a){return a=a.replace(/[\u201C\u201D]/g,'"'),a=a.replace(/[\u2018\u2019]/g,"'"),a=a.replace(/[\u2013]/g,"&#8211;"),a=a.replace(/[\u2014]/g,"&#8212;"),a=a.replace(/[\u2026]/g,"..."),a=a.replace(/cript/gi,"cr&#236;pt"),a=a.replace(/[\u2022]/g,"&#8226;"),a=a.replace(/[\u2122]/g,"&#8482;"),a=a.replace(/[\u2020]/g,"&#8224;"),a=a.replace(/[\u2021]/g,"&#8225;"),a=a.replace(/[\u20AC]/g,"&#8364;")}function getName(a){for(var b=0;b<g_objContacts.length;b++)if(g_objContacts[b].ID==a)return g_objContacts[b].Name;return""}function getColor(a){for(var b=0;b<g_objContacts.length;b++)if(g_objContacts[b].ID==a)return g_objContacts[b].Color;return""}function hex2a(a){for(var b="",c=0;c<a.length;c+=2)b+=String.fromCharCode(parseInt(a.substr(c,2),16));return b}function getRandomInt(a,b){var c=0,d=b-a,e=Math.ceil(Math.log2(d));if(e>53)throw new Exception("We cannot generate numbers larger than 53 bits.");var f=Math.ceil(e/8),g=Math.pow(2,e)-1,h=new Uint8Array(f);window.crypto.getRandomValues(h);for(var i=8*(f-1),j=0;j<f;j++)c+=h[j]*Math.pow(2,i),i-=8;return c&=g,c>=d?getRandomInt(a,b):a+c}function GetRandomCharacter(){var a=new Array("a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9","-","~","@",".","*","(",")","_","{","}","+","#",";","=");return a[getRandomInt(0,a.length-1)]}function getRandomWord(){return g_objSite.Language[0].Words[getRandomInt(0,g_objSite.Language[0].Words.length-1)]}function MakeRandomCode(a){for(var b="",c=0;c<a;c++)b+=GetRandomCharacter();return b.trim()}function TheTimeUntil(a){var b=new Date,c=a.valueOf()-b.valueOf(),d=Math.floor(c/864e5),e=c-24*d*60*60*1e3,f=Math.floor(e/36e5),g=c-(24*d*60*60*1e3+60*f*60*1e3),h=Math.floor(g/6e4),i=c-(24*d*60*60*1e3+60*f*60*1e3+60*h*1e3),j=Math.floor(i/1e3),k=1===d?" day, ":" days, ",l=1===f?" hour, ":" hours, ",m=1===h?" minute, ":" minutes, ",n=1===j?" second":" seconds",o=d?d+k:"";return o+=f||d?f+l:"",o+=h||f||d?h+m:"",o+=j||h||f||d?j+n:""}function YearInRomanNumerals(){var a=new Date,b=a.getFullYear();return toRoman(b)}function toRoman(a){for(var b="",c=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],d=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],e=0;e<c.length;e++)for(;a>=c[e];)b+=d[e],a-=c[e];return b}function MonthNumToText(a){a>11&&(a=0);var b=new Array("January","February","March","April","May","June","July","August","September","October","November","December");return b[a]}function formatAMPM(a){var b=a.getHours(),c=a.getMinutes(),d=b>=12?"PM":"AM";b%=12,b=b?b:12,c=c<10?"0"+c:c;var e=b+":"+c+" "+d;return e}function makeByLine(a){for(var b="",c=0;c<g_objContacts.length;c++)if(g_objUser.ID==g_objContacts[c].ID){b=g_objContacts[c].Name;break}var d="";return d="<span style='color:"+getColor(g_objUser.ID)+"'>",d+="On "+(a.getMonth()+1)+"/"+a.getDate()+"/"+a.getFullYear(),d+=" at "+formatAMPM(a)+" "+a.toString().match(/\(([A-Za-z\s].*)\)/)[1],d+=", "+b+" wrote...</span>"}function removeDuplicates(a){for(var b={},c=[],d=a.length,e=0,f=0;f<d;f++){var g=a[f];1!==b[g]&&(b[g]=1,c[e++]=g)}return c}function removeItem(a,b){var c=b.slice(0),d=c.indexOf(a);return d>-1?(c.splice(d,1),c):c}function isItemInArray(a,b){for(var c=0;c<b.length;c++)if(a==b[c])return!0;return!1}function ConvertToCSV(a){for(var b="object"!=typeof a?JSON.parse(a):a,c="",d=0;d<b.length;d++){var e="";for(var f in b[d])""!==e&&(e+=","),e+=b[d][f];c+=e+"\r\n"}return c}function setCookie(a,b,c){var d=new Date;d.setDate(d.getDate()+c);var e=escape(b)+(null===c?"":"; expires="+d.toUTCString());document.cookie=a+"="+e}function getCookie(a){var b,c,d,e=document.cookie.split(";");for(b=0;b<e.length;b++)if(c=e[b].substr(0,e[b].indexOf("=")),d=e[b].substr(e[b].indexOf("=")+1),c=c.replace(/^\s+|\s+$/g,""),c===a)return unescape(d)}function encodeAES(a,b){return encodeURIComponent(CryptoJS.AES.encrypt(a,b))}function decodeAES(a,b){var c=CryptoJS.AES.decrypt(decodeURIComponent(a),b);return hex2a(c.toString())}function getFileFromServer(a,b){function d(){4===c.readyState&&b(200==c.status?c.responseText:null)}var c;c=new XMLHttpRequest,c.onreadystatechange=d,c.open("GET",a,!0),c.send()}function postFileFromServer(a,b,c){function e(){4===d.readyState&&c(200==d.status?d.responseText:null)}var d;d=new XMLHttpRequest,d.onreadystatechange=e,d.open("POST",a,!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(b)}function URLsToLinks(a,b){var c=-1,d="",e="",f=a.indexOf("http",b);if(-1!==f){c=a.indexOf(" ",f),-1===c&&(c=a.indexOf("\n",f)),d=a.substring(f,c),"<"!=d[d.length-1]&&"\n"!=d[d.length-1]&&","!=d[d.length-1]&&"."!=d[d.length-1]&&"?"!=d[d.length-1]||(d=d.substr(0,d.length-1));var g="<a href='"+d+"' target='_blank' title='"+d+"'>link</a>"+e;a=a.replace(d,g)}return a}var g_objSite=null,g_objUsers=null,g_objUser={},g_objContacts=null,g_objMessages=null,g_aMessages=null,g_sMessageList="",g_objSettings={},g_objCurrentMessage={},g_objPasswords={},g_objNotes={};clearCurrentAddressingArrays();var sort_by_name=function(a,b){var c=a.Name.toLowerCase(),d=b.Name.toLowerCase();return c.localeCompare(d)},sort_passwords=function(a,b){var c=a.PWEntryName.toLowerCase(),d=b.PWEntryName.toLowerCase();return c.localeCompare(d)},sort_notes=function(a,b){var c=a.Title.toLowerCase(),d=b.Title.toLowerCase();return c.localeCompare(d)};